{"version":3,"file":"pickers.min.js","sources":["../src/pickers.js"],"sourcesContent":["define([], function() {\n    const $ = function(sel, root) {\n        root = root || document;\n        return root.querySelector(sel);\n    };\n    const $$ = function(sel, root) {\n        root = root || document;\n        return Array.from(root.querySelectorAll(sel));\n    };\n\n    const attachPicker = function(config) {\n        const openId = config.openId;\n        const modalId = config.modalId;\n        const closeId = config.closeId;\n        const cancelId = config.cancelId;\n        const itemSelector = config.itemSelector;\n        const targetId = config.targetId;\n        const backdropId = config.backdropId || 'ai4t-modal-backdrop';\n\n        const openBtn = document.getElementById(openId);\n        const modal = document.getElementById(modalId);\n        const backdrop = document.getElementById(backdropId);\n        const closeBtn = document.getElementById(closeId);\n        const cancelBtn = document.getElementById(cancelId);\n        const target = document.getElementById(targetId);\n\n        const open = function() {\n            if (modal && backdrop) {\n                modal.style.display = 'block';\n                backdrop.style.display = 'block';\n                modal.focus();\n            }\n        };\n        const close = function() {\n            if (modal && backdrop) {\n                modal.style.display = 'none';\n                backdrop.style.display = 'none';\n            }\n        };\n        const pick = function(el) {\n            const v = el.getAttribute('data-value');\n            if (target && v !== null) {\n                target.value = v;\n                target.dispatchEvent(new Event('input', {bubbles: true}));\n            }\n            close();\n        };\n\n        if (openBtn) {\n            openBtn.addEventListener('click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                open();\n            });\n        }\n        if (closeBtn) {\n            closeBtn.addEventListener('click', close);\n        }\n        if (cancelBtn) {\n            cancelBtn.addEventListener('click', close);\n        }\n        if (backdrop) {\n            backdrop.addEventListener('click', close);\n        }\n        document.addEventListener('keydown', function(ev) {\n            if (ev.key === 'Escape') {\n                close();\n            }\n        });\n        $$(itemSelector).forEach(function(li) {\n            li.addEventListener('click', function() {\n                pick(li);\n            });\n            li.addEventListener('keydown', function(ev) {\n                if (ev.key === 'Enter' || ev.key === ' ') {\n                    ev.preventDefault();\n                    pick(li);\n                }\n            });\n        });\n    };\n\n    const attachOutcomesModal = function() {\n        const openBtn = $('#ai4t-outcomes-browse');\n        const modal = $('#ai4t-outcomes-modal');\n        const backdrop = $('#ai4t-modal-backdrop');\n        const closeBtn = $('#ai4t-outcomes-modal-close');\n        const cancelBtn = $('#ai4t-outcomes-modal-cancel');\n        const insertBtn = $('#ai4t-outcomes-modal-insert');\n        const ta = $('#id_outcomes');\n\n        const open = function() {\n            if (modal && backdrop) {\n                modal.style.display = 'block';\n                backdrop.style.display = 'block';\n                modal.focus();\n            }\n        };\n        const close = function() {\n            if (modal && backdrop) {\n                modal.style.display = 'none';\n                backdrop.style.display = 'none';\n            }\n        };\n\n        if (openBtn) {\n            openBtn.addEventListener('click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                open();\n            });\n        }\n        if (closeBtn) {\n            closeBtn.addEventListener('click', close);\n        }\n        if (cancelBtn) {\n            cancelBtn.addEventListener('click', close);\n        }\n        if (insertBtn) {\n            insertBtn.addEventListener('click', function() {\n                if (!ta) {\n                    close();\n                    return;\n                }\n                const vals = $$('.ai4t-outcome-checkbox:checked').map(function(cb) {\n                    return cb.value;\n                }).filter(Boolean);\n                if (!vals.length) {\n                    close();\n                    return;\n                }\n                let cur = ta.value || '';\n                if (cur && !/\\n$/.test(cur)) {\n                    cur += '\\n';\n                }\n                ta.value = cur + vals.join('\\n');\n                ta.dispatchEvent(new Event('input', {bubbles: true}));\n                close();\n            });\n        }\n        if (backdrop) {\n            backdrop.addEventListener('click', close);\n        }\n    };\n\n    const initLanguageModal = function() {\n        const openBtn = $('#ai4t-language-browse');\n        const modal = $('#ai4t-language-modal');\n        const backdrop = $('#ai4t-modal-backdrop');\n        const closeBtn = $('#ai4t-language-modal-close');\n        const cancelBtn = $('#ai4t-language-modal-cancel');\n        const input = $('#id_language');\n        const codeEl = $('#id_languagecode');\n\n        const open = function() {\n            if (modal && backdrop) {\n                modal.style.display = 'block';\n                backdrop.style.display = 'block';\n                modal.focus();\n            }\n        };\n        const close = function() {\n            if (modal && backdrop) {\n                modal.style.display = 'none';\n                backdrop.style.display = 'none';\n            }\n        };\n        const sync = function() {\n            if (!input || !codeEl) {\n                return;\n            }\n            const t = (input.value || '').trim();\n            if (!t) {\n                return;\n            }\n            const m = t.match(/\\(([a-z]{2,3}(?:[_-][a-z]{2,3})?)\\)/i);\n            if (m) {\n                codeEl.value = m[1].replace('-', '_').toLowerCase();\n                return;\n            }\n            $$('.ai4t-language-item').some(function(li) {\n                const name = li.getAttribute('data-name') || '';\n                if (name.toLowerCase() === t.toLowerCase()) {\n                    codeEl.value = li.getAttribute('data-code');\n                    return true;\n                }\n                return false;\n            });\n        };\n\n        if (openBtn) {\n            openBtn.addEventListener('click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                open();\n            });\n        }\n        if (closeBtn) {\n            closeBtn.addEventListener('click', close);\n        }\n        if (cancelBtn) {\n            cancelBtn.addEventListener('click', close);\n        }\n        if (backdrop) {\n            backdrop.addEventListener('click', close);\n        }\n        $$('.ai4t-language-item').forEach(function(li) {\n            li.addEventListener('click', function() {\n                if (input) {\n                    input.value = li.getAttribute('data-name') || '';\n                    input.dispatchEvent(new Event('input', {bubbles: true}));\n                }\n                if (codeEl) {\n                    codeEl.value = li.getAttribute('data-code') || '';\n                }\n                close();\n            });\n        });\n        if (input) {\n            input.addEventListener('blur', sync);\n            input.addEventListener('change', sync);\n        }\n    };\n\n    return {\n        attachPicker: attachPicker,\n        attachOutcomesModal: attachOutcomesModal,\n        initLanguageModal: initLanguageModal\n    };\n});\n"],"names":["define","$","sel","root","document","querySelector","$$","Array","from","querySelectorAll","attachPicker","config","openId","modalId","closeId","cancelId","itemSelector","targetId","backdropId","openBtn","getElementById","modal","backdrop","closeBtn","cancelBtn","target","close","style","display","pick","el","v","getAttribute","value","dispatchEvent","Event","bubbles","addEventListener","e","preventDefault","stopPropagation","focus","ev","key","forEach","li","attachOutcomesModal","insertBtn","ta","vals","map","cb","filter","Boolean","length","cur","test","join","initLanguageModal","input","codeEl","sync","t","trim","m","match","replace","toLowerCase","some"],"mappings":"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"}