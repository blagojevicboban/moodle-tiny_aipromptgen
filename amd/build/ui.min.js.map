{"version":3,"file":"ui.min.js","sources":["../src/ui.js"],"sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n/**\n * Main UI controller for the AI Prompt Generator.\n *\n * @package\n * @copyright  2025 AI4Teachers\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['core/str'], function(Str) {\n    return {\n        init: function() {\n            require([\n                'tiny_aipromptgen/age',\n                'tiny_aipromptgen/pickers',\n                'tiny_aipromptgen/actions',\n                'tiny_aipromptgen/stream',\n                'tiny_aipromptgen/markdown'\n            ], function(Age, Pickers, Actions, Stream, Markdown) {\n\n                var updatePrompt = function() {\n                    var getValue = function(id) {\n                        var el = document.getElementById(id);\n                        return el ? el.value : '';\n                    };\n\n                    var subject = getValue('id_subject');\n                    if (!subject) {\n                        var subjectEl = document.getElementById('id_subject');\n                        if (subjectEl && subjectEl.placeholder) {\n                            subject = subjectEl.placeholder;\n                        }\n                    }\n\n                    var age = getValue('id_agerange');\n                    var topic = getValue('id_topic');\n                    var lesson = getValue('id_lesson');\n                    var count = getValue('id_lessoncount') || '1';\n                    var duration = getValue('id_lessonduration') || '45';\n                    var classtype = getValue('id_classtype');\n                    var purpose = getValue('id_purpose');\n                    var audience = getValue('id_audience');\n                    var outcomes = getValue('id_outcomes');\n                    var language = getValue('id_language');\n\n                    Str.get_strings([\n                        {key: 'prompt:expert', component: 'tiny_aipromptgen'},\n                        {key: 'prompt:subject', component: 'tiny_aipromptgen', param: subject},\n                        {key: 'prompt:age', component: 'tiny_aipromptgen', param: age},\n                        {key: 'prompt:topic', component: 'tiny_aipromptgen', param: topic},\n                        {key: 'prompt:lesson_title', component: 'tiny_aipromptgen', param: lesson},\n                        {key: 'prompt:num_lessons', component: 'tiny_aipromptgen', param: count},\n                        {key: 'prompt:duration', component: 'tiny_aipromptgen', param: duration},\n                        {key: 'prompt:class_type', component: 'tiny_aipromptgen', param: classtype},\n                        {key: 'prompt:purpose', component: 'tiny_aipromptgen', param: purpose},\n                        {key: 'prompt:audience', component: 'tiny_aipromptgen', param: audience},\n                        {key: 'prompt:outcomes', component: 'tiny_aipromptgen'},\n                        {key: 'prompt:language', component: 'tiny_aipromptgen', param: language || ''},\n                        {key: 'prompt:footer', component: 'tiny_aipromptgen'},\n                        {key: 'default:language', component: 'tiny_aipromptgen'}\n                    ]).then(function(strings) {\n                        var sExpert = strings[0], sSubject = strings[1], sAge = strings[2],\n                            sTopic = strings[3], sLessonTitle = strings[4], sNumLessons = strings[5],\n                            sDuration = strings[6], sClassType = strings[7], sPurpose = strings[8],\n                            sAudience = strings[9], sOutcomes = strings[10], sLanguage = strings[11],\n                            sFooter = strings[12], sDefLang = strings[13];\n\n                        var usedLang = language || sDefLang;\n                        if (!language) {\n                            // Re-fetch localized language string if we had to fall back.\n                            sLanguage = sLanguage.replace('{$a}', usedLang);\n                        }\n\n                        var p = sExpert + \"\\n\";\n                        if (subject) {\n                            p += sSubject + \"\\n\";\n                        }\n                        if (age) {\n                            p += sAge + \"\\n\";\n                        }\n                        if (topic) {\n                            p += sTopic + \"\\n\";\n                        }\n                        if (lesson) {\n                            p += sLessonTitle + \"\\n\";\n                        }\n                        p += sNumLessons + \"\\n\";\n                        p += sDuration + \"\\n\";\n                        if (classtype) {\n                            p += sClassType + \"\\n\";\n                        }\n                        if (purpose) {\n                            p += sPurpose + \"\\n\";\n                        }\n                        if (audience) {\n                            p += sAudience + \"\\n\";\n                        }\n                        if (outcomes) {\n                            p += sOutcomes + \"\\n\" + outcomes + \"\\n\";\n                        }\n                        p += sLanguage + \"\\n\";\n                        p += \"\\n\" + sFooter;\n\n                        var gen = document.getElementById('ai4t-generated');\n                        if (gen) {\n                            gen.value = p;\n                            gen.dispatchEvent(new Event('input', {bubbles: true}));\n                        }\n                        return p;\n                    }).catch(function() {\n                        // Fallback.\n                    });\n                };\n\n                var initAutoUpdate = function() {\n                    var ids = [\n                        'id_subject', 'id_agerange', 'id_topic', 'id_lesson',\n                        'id_lessoncount', 'id_lessonduration', 'id_classtype',\n                        'id_purpose', 'id_audience', 'id_outcomes', 'id_language'\n                    ];\n\n                    ids.forEach(function(id) {\n                        var el = document.getElementById(id);\n                        if (el) {\n                            el.addEventListener('input', updatePrompt);\n                            el.addEventListener('change', updatePrompt);\n                        }\n                    });\n\n                    setTimeout(updatePrompt, 500);\n                };\n\n                var initProviderSend = function() {\n                    var sendBtn = document.getElementById('ai4t-sendtoai');\n                    var select = document.getElementById('ai4t-provider');\n                    var gen = document.getElementById('ai4t-generated');\n                    var hidden = document.getElementById('ai4t-sendto');\n\n                    if (!hidden && sendBtn) {\n                        var form = document.getElementById('mform1') ||\n                                   document.getElementById('promptform') ||\n                                   sendBtn.closest('form');\n                        if (form) {\n                            hidden = document.createElement('input');\n                            hidden.type = 'hidden';\n                            hidden.name = 'sendto';\n                            hidden.id = 'ai4t-sendto';\n                            form.appendChild(hidden);\n                        }\n                    }\n\n                    if (!sendBtn || !select || !gen) {\n                        return;\n                    }\n\n                    var refreshState = function() {\n                        var opt = select.options[select.selectedIndex];\n                        var unconfigured = opt && /âœ•\\s*$/.test(opt.textContent || '');\n                        sendBtn.disabled = (!gen.value.trim() || unconfigured);\n                    };\n\n                    select.addEventListener('change', refreshState);\n                    gen.addEventListener('input', refreshState);\n\n                    sendBtn.addEventListener('click', function(e) {\n                        if (sendBtn.disabled) {\n                            return;\n                        }\n                        var provider = select.value;\n                        var form = document.getElementById('ai4t-send-form');\n\n                        if (provider === 'ollama') {\n                            e.preventDefault();\n                            var resp = document.getElementById('ai4t-airesponse-body') ||\n                                       document.getElementById('ai4t-airesponse');\n\n                            Stream.startStream(function() {\n                                return form;\n                            }, gen, hidden, resp, function() {\n                                // No-op scroll.\n                            });\n                            return;\n                        }\n\n                        sendBtn.disabled = true;\n                        Str.get_string('status:generating', 'tiny_aipromptgen').then(function(s) {\n                            sendBtn.textContent = s;\n                            return s;\n                        }).catch(function() {\n                            sendBtn.textContent = 'Generating...';\n                        });\n\n                        hidden.value = provider;\n                        if (form) {\n                            form.submit();\n                        }\n                    });\n                    refreshState();\n                };\n\n                var initResponseModal = function() {\n                    var modal = document.getElementById('ai4t-airesponse-modal');\n                    if (!modal) {\n                        return;\n                    }\n\n                    var bodyRaw = document.getElementById('ai4t-airesponse-body');\n                    var bodyText = document.getElementById('ai4t-airesponse-text');\n                    var bodyHtml = document.getElementById('ai4t-airesponse-html');\n                    var bodyCode = document.getElementById('ai4t-airesponse-code');\n                    var backdrop = document.getElementById('ai4t-modal-backdrop');\n\n                    var setView = function(view) {\n                        var btns = ['raw', 'text', 'html', 'rich'].map(function(v) {\n                            return document.getElementById('ai4t-btn-' + v);\n                        });\n                        var bodies = [bodyRaw, bodyText, bodyHtml, bodyCode];\n\n                        btns.forEach(function(btn) {\n                            if (btn) {\n                                btn.classList.remove('btn-secondary');\n                                btn.classList.add('btn-outline-secondary');\n                            }\n                        });\n                        bodies.forEach(function(b) {\n                            if (b) {\n                                b.style.display = 'none';\n                            }\n                        });\n\n                        applyView(view, btns, bodies, bodyRaw, bodyText, bodyCode, bodyHtml, Markdown);\n                    };\n\n                    document.addEventListener('click', function(e) {\n                        handleModalClick(e, modal, backdrop, {\n                            bodyRaw: bodyRaw, bodyText: bodyText, bodyHtml: bodyHtml, bodyCode: bodyCode,\n                            setView: setView, showStatus: showStatus, copyRichText: copyRichText\n                        });\n                    });\n\n                    if (bodyRaw && bodyRaw.textContent.trim().length > 0) {\n                        modal.style.display = 'block';\n                        if (backdrop) {\n                            backdrop.style.display = 'block';\n                        }\n                        setView('rich');\n                    }\n                };\n\n                var applyView = function(view, btns, bodies, bodyRaw, bodyText, bodyCode, bodyHtml, Markdown) {\n                    var map = {raw: 0, text: 1, html: 2, rich: 3};\n                    var idx = map[view];\n                    if (btns[idx]) {\n                        btns[idx].classList.remove('btn-outline-secondary');\n                        btns[idx].classList.add('btn-secondary');\n                    }\n\n                    if (view === 'raw' && bodyRaw) {\n                        bodyRaw.style.display = 'block';\n                    } else if (view === 'text' && bodyText) {\n                        bodyText.style.display = 'block';\n                        bodyText.textContent = Markdown.renderText(bodyRaw.textContent);\n                    } else if (view === 'html' && bodyCode) {\n                        bodyCode.style.display = 'block';\n                        bodyCode.textContent = Markdown.renderMarkdown(bodyRaw.textContent);\n                    } else if (view === 'rich' && bodyHtml) {\n                        bodyHtml.style.display = 'block';\n                        try {\n                            bodyHtml.innerHTML = Markdown.renderMarkdown(bodyRaw.textContent);\n                        } catch (e) {\n                            Str.get_string('status:error_rendering_markdown', 'tiny_aipromptgen').then(function(s) {\n                                bodyHtml.innerHTML = '<p>' + s + '</p>';\n                                return s;\n                            }).catch(function() {\n                                bodyHtml.innerHTML = '<p>Error rendering Markdown.</p>';\n                            });\n                        }\n                    }\n                };\n\n                var handleModalClick = function(e, modal, backdrop, refs) {\n                    var btn = e.target.closest('button');\n                    var t = e.target;\n                    if (btn) {\n                        if (btn.id === 'ai4t-btn-raw') {\n                            refs.setView('raw');\n                        } else if (btn.id === 'ai4t-btn-text') {\n                            refs.setView('text');\n                        } else if (btn.id === 'ai4t-btn-html') {\n                            refs.setView('html');\n                        } else if (btn.id === 'ai4t-btn-rich') {\n                            refs.setView('rich');\n                        } else if (btn.id === 'ai4t-airesponse-modal-close-btn') {\n                            modal.style.display = 'none';\n                            if (backdrop) {\n                                backdrop.style.display = 'none';\n                            }\n                        } else if (btn.id === 'ai4t-airesponse-modal-copy-btn') {\n                            handleCopy(refs);\n                        } else if (btn.id === 'ai4t-airesponse-modal-insert-btn') {\n                            handleInsert(refs);\n                        }\n                    }\n                    if (t && t.id === 'ai4t-airesponse-modal-close') {\n                        modal.style.display = 'none';\n                        if (backdrop) {\n                            backdrop.style.display = 'none';\n                        }\n                    }\n                };\n\n                var handleCopy = function(refs) {\n                    if (refs.bodyHtml && refs.bodyHtml.style.display !== 'none') {\n                        if (refs.copyRichText(refs.bodyHtml)) {\n                            showStatusById('status:copiedrichtext');\n                        } else {\n                            showStatusById('status:copyfailed');\n                        }\n                    } else {\n                        var text = '';\n                        if (refs.bodyRaw && refs.bodyRaw.style.display !== 'none') {\n                            text = refs.bodyRaw.textContent;\n                        } else if (refs.bodyText && refs.bodyText.style.display !== 'none') {\n                            text = refs.bodyText.textContent;\n                        } else if (refs.bodyCode && refs.bodyCode.style.display !== 'none') {\n                            text = refs.bodyCode.textContent;\n                        }\n\n                        if (navigator.clipboard && navigator.clipboard.writeText) {\n                            navigator.clipboard.writeText(text).then(function() {\n                                showStatusById('status:copiedclipboard');\n                                return;\n                            }).catch(function() {\n                                // Silent fail.\n                            });\n                        } else {\n                            var ta = document.createElement('textarea');\n                            ta.value = text;\n                            document.body.appendChild(ta);\n                            ta.select();\n                            document.execCommand('copy');\n                            document.body.removeChild(ta);\n                            showStatusById('form:copied');\n                        }\n                    }\n                };\n\n                var showStatusById = function(id) {\n                    Str.get_string(id, 'tiny_aipromptgen').then(function(s) {\n                        showStatus(s);\n                        return s;\n                    }).catch(function() {\n                        // Silent fail.\n                    });\n                };\n\n                var showStatus = function(msg) {\n                    var status = document.getElementById('ai4t-modal-copy-status');\n                    if (status) {\n                        status.textContent = msg;\n                        status.style.display = 'inline';\n                        setTimeout(function() {\n                            status.style.display = 'none';\n                        }, 2000);\n                    } else {\n                        window.console.log(msg);\n                    }\n                };\n\n                var handleInsert = function(refs) {\n                    var content = '';\n                    if (refs.bodyHtml && refs.bodyHtml.style.display !== 'none') {\n                        content = refs.bodyHtml.innerHTML;\n                    } else if (refs.bodyCode && refs.bodyCode.style.display !== 'none') {\n                        content = refs.bodyCode.textContent;\n                    } else if (refs.bodyText && refs.bodyText.style.display !== 'none') {\n                        content = refs.bodyText.textContent.trim().split(/\\n+/).map(function(p) {\n                            return '<p>' + p.trim() + '</p>';\n                        }).join('');\n                    } else if (refs.bodyRaw && refs.bodyRaw.style.display !== 'none') {\n                        content = refs.bodyRaw.textContent.replace(/\\n/g, '<br>');\n                    }\n\n                    if (window.opener && window.opener.tinyMCE && window.opener.tinyMCE.activeEditor) {\n                        try {\n                            window.opener.tinyMCE.activeEditor.insertContent(content);\n                            window.close();\n                        } catch (e) {\n                            window.console.error('Failed to insert content. The editor window might be closed.');\n                        }\n                    } else {\n                        window.console.error('Could not find the parent editor window.');\n                    }\n                };\n\n                var copyRichText = function(el) {\n                    try {\n                        var range = document.createRange();\n                        range.selectNode(el);\n                        var selection = window.getSelection();\n                        selection.removeAllRanges();\n                        selection.addRange(range);\n                        var successful = document.execCommand('copy');\n                        selection.removeAllRanges();\n                        return successful;\n                    } catch (e) {\n                        return false;\n                    }\n                };\n\n                // Initialize all modules\n                var inits = [\n                    function() {\n                        Age.initAgeModal();\n                    },\n                    function() {\n                        Pickers.attachPicker({\n                            openId: 'ai4t-lesson-browse', modalId: 'ai4t-modal',\n                            closeId: 'ai4t-modal-close', cancelId: 'ai4t-modal-cancel',\n                            itemSelector: '.ai4t-lesson-item', targetId: 'id_lesson'\n                        });\n                        Pickers.attachPicker({\n                            openId: 'ai4t-topic-browse', modalId: 'ai4t-topic-modal',\n                            closeId: 'ai4t-topic-modal-close', cancelId: 'ai4t-topic-modal-cancel',\n                            itemSelector: '.ai4t-topic-item', targetId: 'id_topic'\n                        });\n                        Pickers.attachOutcomesModal();\n                        Pickers.initLanguageModal();\n                        ['purpose', 'audience', 'classtype'].forEach(function(k) {\n                            Pickers.attachPicker({\n                                openId: 'ai4t-' + k + '-browse', modalId: 'ai4t-' + k + '-modal',\n                                closeId: 'ai4t-' + k + '-modal-close', cancelId: 'ai4t-' + k + '-modal-cancel',\n                                itemSelector: '.ai4t-' + k + '-item', targetId: 'id_' + k\n                            });\n                        });\n                    },\n                    function() {\n                        Actions.attachCopyDownload();\n                    },\n                    function() {\n                        initProviderSend();\n                    },\n                    function() {\n                        initAutoUpdate();\n                    },\n                    function() {\n                        initResponseModal();\n                    }\n                ];\n\n                inits.forEach(function(fn) {\n                    try {\n                        fn();\n                    } catch (e) {\n                        /* Silent fail */\n                    }\n                });\n            });\n        }\n    };\n});\n"],"names":["define","Str","init","require","Age","Pickers","Actions","Stream","Markdown","updatePrompt","getValue","id","el","document","getElementById","value","subject","subjectEl","placeholder","age","topic","lesson","count","duration","classtype","purpose","audience","outcomes","language","get_strings","key","component","param","then","strings","sExpert","sSubject","sAge","sTopic","sLessonTitle","sNumLessons","sDuration","sClassType","sPurpose","sAudience","sOutcomes","sLanguage","sFooter","sDefLang","usedLang","replace","p","gen","dispatchEvent","Event","bubbles","catch","applyView","view","btns","bodies","bodyRaw","bodyText","bodyCode","bodyHtml","idx","raw","text","html","rich","classList","remove","add","style","display","textContent","renderText","renderMarkdown","innerHTML","e","get_string","s","handleModalClick","modal","backdrop","refs","btn","target","closest","t","setView","handleCopy","handleInsert","copyRichText","showStatusById","navigator","clipboard","writeText","ta","createElement","body","appendChild","select","execCommand","removeChild","showStatus","msg","status","setTimeout","window","console","log","content","trim","split","map","join","opener","tinyMCE","activeEditor","insertContent","close","error","range","createRange","selectNode","selection","getSelection","removeAllRanges","addRange","successful","initAgeModal","attachPicker","openId","modalId","closeId","cancelId","itemSelector","targetId","attachOutcomesModal","initLanguageModal","forEach","k","attachCopyDownload","sendBtn","hidden","form","type","name","refreshState","opt","options","selectedIndex","unconfigured","test","disabled","addEventListener","provider","submit","preventDefault","resp","startStream","initProviderSend","v","b","length","initResponseModal","fn"],"mappings":"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"}