define("tiny_aipromptgen/ui",[],(function(){return{init:function(){require(["tiny_aipromptgen/age","tiny_aipromptgen/pickers","tiny_aipromptgen/actions","tiny_aipromptgen/stream","tiny_aipromptgen/markdown"],(function(Age,Pickers,Actions,Stream,Markdown){var updatePrompt=function(){var getValue=function(id){var el=document.getElementById(id);return el?el.value:""},subject=getValue("id_subject");if(!subject){var subjectEl=document.getElementById("id_subject");subjectEl&&subjectEl.placeholder&&(subject=subjectEl.placeholder)}var age=getValue("id_agerange"),topic=getValue("id_topic"),lesson=getValue("id_lesson"),count=getValue("id_lessoncount")||"1",duration=getValue("id_lessonduration")||"45",classtype=getValue("id_classtype"),purpose=getValue("id_purpose"),audience=getValue("id_audience"),outcomes=getValue("id_outcomes"),p="You are an expert teacher. Create a detailed lesson plan.\n";p+="Subject: "+subject+"\n",age&&(p+="Student Age: "+age+" years old\n"),topic&&(p+="Topic: "+topic+"\n"),lesson&&(p+="Lesson Title: "+lesson+"\n"),p+="Number of lessons: "+count+"\n",p+="Duration per lesson: "+duration+" minutes\n",classtype&&(p+="Class Type: "+classtype+"\n"),purpose&&(p+="Purpose: "+purpose+"\n"),audience&&(p+="Target Audience: "+audience+"\n"),outcomes&&(p+="Learning Outcomes/Competencies:\n"+outcomes+"\n"),p+="Language: "+(getValue("id_language")||"English")+"\n",p+="\nPlease provide a structured lesson plan with objectives, activities, and timeline.";var gen=document.getElementById("ai4t-generated");gen&&(gen.value=p,gen.dispatchEvent(new Event("input",{bubbles:!0})))},applyView=function(view,btns,bodies,bodyRaw,bodyText,bodyCode,bodyHtml,Markdown){var idx={raw:0,text:1,html:2,rich:3}[view];if(btns[idx]&&(btns[idx].classList.remove("btn-outline-secondary"),btns[idx].classList.add("btn-secondary")),"raw"===view&&bodyRaw)bodyRaw.style.display="block";else if("text"===view&&bodyText)bodyText.style.display="block",bodyText.textContent=Markdown.renderText(bodyRaw.textContent);else if("html"===view&&bodyCode)bodyCode.style.display="block",bodyCode.textContent=Markdown.renderMarkdown(bodyRaw.textContent);else if("rich"===view&&bodyHtml){bodyHtml.style.display="block";try{bodyHtml.innerHTML=Markdown.renderMarkdown(bodyRaw.textContent)}catch(e){bodyHtml.innerHTML="<p>Error rendering Markdown.</p>"}}},handleModalClick=function(e,modal,backdrop,refs){var btn=e.target.closest("button"),t=e.target;btn&&("ai4t-btn-raw"===btn.id?refs.setView("raw"):"ai4t-btn-text"===btn.id?refs.setView("text"):"ai4t-btn-html"===btn.id?refs.setView("html"):"ai4t-btn-rich"===btn.id?refs.setView("rich"):"ai4t-airesponse-modal-close-btn"===btn.id?(modal.style.display="none",backdrop&&(backdrop.style.display="none")):"ai4t-airesponse-modal-copy-btn"===btn.id?handleCopy(refs):"ai4t-airesponse-modal-insert-btn"===btn.id&&handleInsert(refs)),t&&"ai4t-airesponse-modal-close"===t.id&&(modal.style.display="none",backdrop&&(backdrop.style.display="none"))},handleCopy=function(refs){if(refs.bodyHtml&&"none"!==refs.bodyHtml.style.display)refs.copyRichText(refs.bodyHtml)?refs.showStatus("Copied as Rich Text!"):refs.showStatus("Copy failed");else{var text="";if(refs.bodyRaw&&"none"!==refs.bodyRaw.style.display?text=refs.bodyRaw.textContent:refs.bodyText&&"none"!==refs.bodyText.style.display?text=refs.bodyText.textContent:refs.bodyCode&&"none"!==refs.bodyCode.style.display&&(text=refs.bodyCode.textContent),navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(text).then((function(){refs.showStatus("Copied to clipboard!")})).catch((function(){}));else{var ta=document.createElement("textarea");ta.value=text,document.body.appendChild(ta),ta.select(),document.execCommand("copy"),document.body.removeChild(ta),refs.showStatus("Copied!")}}},showStatus=function(msg){var status=document.getElementById("ai4t-modal-copy-status");status?(status.textContent=msg,status.style.display="inline",setTimeout((function(){status.style.display="none"}),2e3)):window.console.log(msg)},handleInsert=function(refs){var content="";if(refs.bodyHtml&&"none"!==refs.bodyHtml.style.display?content=refs.bodyHtml.innerHTML:refs.bodyCode&&"none"!==refs.bodyCode.style.display?content=refs.bodyCode.textContent:refs.bodyText&&"none"!==refs.bodyText.style.display?content=refs.bodyText.textContent.trim().split(/\n+/).map((function(p){return"<p>"+p.trim()+"</p>"})).join(""):refs.bodyRaw&&"none"!==refs.bodyRaw.style.display&&(content=refs.bodyRaw.textContent.replace(/\n/g,"<br>")),window.opener&&window.opener.tinyMCE&&window.opener.tinyMCE.activeEditor)try{window.opener.tinyMCE.activeEditor.insertContent(content),window.close()}catch(e){window.console.error("Failed to insert content. The editor window might be closed.")}else window.console.error("Could not find the parent editor window.")},copyRichText=function(el){try{var range=document.createRange();range.selectNode(el);var selection=window.getSelection();selection.removeAllRanges(),selection.addRange(range);var successful=document.execCommand("copy");return selection.removeAllRanges(),successful}catch(e){return!1}};[function(){Age.initAgeModal()},function(){Pickers.attachPicker({openId:"ai4t-lesson-browse",modalId:"ai4t-modal",closeId:"ai4t-modal-close",cancelId:"ai4t-modal-cancel",itemSelector:".ai4t-lesson-item",targetId:"id_lesson"}),Pickers.attachPicker({openId:"ai4t-topic-browse",modalId:"ai4t-topic-modal",closeId:"ai4t-topic-modal-close",cancelId:"ai4t-topic-modal-cancel",itemSelector:".ai4t-topic-item",targetId:"id_topic"}),Pickers.attachOutcomesModal(),Pickers.initLanguageModal(),["purpose","audience","classtype"].forEach((function(k){Pickers.attachPicker({openId:"ai4t-"+k+"-browse",modalId:"ai4t-"+k+"-modal",closeId:"ai4t-"+k+"-modal-close",cancelId:"ai4t-"+k+"-modal-cancel",itemSelector:".ai4t-"+k+"-item",targetId:"id_"+k})}))},function(){Actions.attachCopyDownload()},function(){!function(){var sendBtn=document.getElementById("ai4t-sendtoai"),select=document.getElementById("ai4t-provider"),gen=document.getElementById("ai4t-generated"),hidden=document.getElementById("ai4t-sendto");if(!hidden&&sendBtn){var form=document.getElementById("mform1")||document.getElementById("promptform")||sendBtn.closest("form");form&&((hidden=document.createElement("input")).type="hidden",hidden.name="sendto",hidden.id="ai4t-sendto",form.appendChild(hidden))}if(sendBtn&&select&&gen){var refreshState=function(){var opt=select.options[select.selectedIndex],unconfigured=opt&&/âœ•\s*$/.test(opt.textContent||"");sendBtn.disabled=!gen.value.trim()||unconfigured};select.addEventListener("change",refreshState),gen.addEventListener("input",refreshState),sendBtn.addEventListener("click",(function(e){if(!sendBtn.disabled){var provider=select.value,form=document.getElementById("ai4t-send-form");if("ollama"!==provider)sendBtn.disabled=!0,sendBtn.textContent="Generating...",hidden.value=provider,form&&form.submit();else{e.preventDefault();var resp=document.getElementById("ai4t-airesponse-body")||document.getElementById("ai4t-airesponse");Stream.startStream((function(){return form}),gen,hidden,resp,(function(){}))}}})),refreshState()}}()},function(){["id_subject","id_agerange","id_topic","id_lesson","id_lessoncount","id_lessonduration","id_classtype","id_purpose","id_audience","id_outcomes","id_language"].forEach((function(id){var el=document.getElementById(id);el&&(el.addEventListener("input",updatePrompt),el.addEventListener("change",updatePrompt))})),setTimeout(updatePrompt,500)},function(){!function(){var modal=document.getElementById("ai4t-airesponse-modal");if(modal){var bodyRaw=document.getElementById("ai4t-airesponse-body"),bodyText=document.getElementById("ai4t-airesponse-text"),bodyHtml=document.getElementById("ai4t-airesponse-html"),bodyCode=document.getElementById("ai4t-airesponse-code"),backdrop=document.getElementById("ai4t-modal-backdrop"),setView=function(view){var btns=["raw","text","html","rich"].map((function(v){return document.getElementById("ai4t-btn-"+v)})),bodies=[bodyRaw,bodyText,bodyHtml,bodyCode];btns.forEach((function(btn){btn&&(btn.classList.remove("btn-secondary"),btn.classList.add("btn-outline-secondary"))})),bodies.forEach((function(b){b&&(b.style.display="none")})),applyView(view,btns,bodies,bodyRaw,bodyText,bodyCode,bodyHtml,Markdown)};document.addEventListener("click",(function(e){handleModalClick(e,modal,backdrop,{bodyRaw:bodyRaw,bodyText:bodyText,bodyHtml:bodyHtml,bodyCode:bodyCode,setView:setView,showStatus:showStatus,copyRichText:copyRichText})})),bodyRaw&&bodyRaw.textContent.trim().length>0&&(modal.style.display="block",backdrop&&(backdrop.style.display="block"),setView("rich"))}}()}].forEach((function(fn){try{fn()}catch(e){}}))}))}}}));

//# sourceMappingURL=ui.min.js.map