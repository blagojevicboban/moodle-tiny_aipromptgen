define("tiny_aipromptgen/plugin",["exports","editor_tiny/loader","editor_tiny/utils","./configuration"],(function(_exports,_loader,_utils,Configuration){function _getRequireWildcardCache(nodeInterop){if("function"!=typeof WeakMap)return null;var cacheBabelInterop=new WeakMap,cacheNodeInterop=new WeakMap;return(_getRequireWildcardCache=function(nodeInterop){return nodeInterop?cacheNodeInterop:cacheBabelInterop})(nodeInterop)}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,Configuration=function(obj,nodeInterop){if(!nodeInterop&&obj&&obj.__esModule)return obj;if(null===obj||"object"!=typeof obj&&"function"!=typeof obj)return{default:obj};var cache=_getRequireWildcardCache(nodeInterop);if(cache&&cache.has(obj))return cache.get(obj);var newObj={},hasPropertyDescriptor=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var key in obj)if("default"!==key&&Object.prototype.hasOwnProperty.call(obj,key)){var desc=hasPropertyDescriptor?Object.getOwnPropertyDescriptor(obj,key):null;desc&&(desc.get||desc.set)?Object.defineProperty(newObj,key,desc):newObj[key]=obj[key]}newObj.default=obj,cache&&cache.set(obj,newObj);return newObj}(Configuration);var _default=Promise.all([(0,_loader.getTinyMCE)(),(0,_utils.getPluginMetadata)("tiny_aipromptgen","tiny_aipromptgen/plugin")]).then((_ref=>{let[tinyMCE,pluginMetadata]=_ref;return tinyMCE.PluginManager.add("tiny_aipromptgen/plugin",(editor=>{editor.ui.registry.addIcon("tiny-aipromptgen-icon",'<svg width="24" height="24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="10" rx="2"></rect><circle cx="12" cy="5" r="2"></circle><path d="M12 7v4"></path><circle cx="8" cy="16" r="1.5" fill="white" stroke="none"></circle><circle cx="16" cy="16" r="1.5" fill="white" stroke="none"></circle></svg>');var openPromptGenerator=function(){var courseId="1",urlParams=new URLSearchParams(window.location.search);if(urlParams.has("courseid"))courseId=urlParams.get("courseid");else if(urlParams.has("id"))if(-1!==window.location.href.indexOf("/course/view.php"))courseId=urlParams.get("id");else{var link=document.querySelector('a[href*="/course/view.php?id="]');if(link){var m=link.href.match(/id=(\d+)/);m&&(courseId=m[1])}}if(window.M&&window.M.cfg&&window.M.cfg.courseId&&1!=window.M.cfg.courseId&&(courseId=window.M.cfg.courseId),"1"===courseId){var cInput=document.querySelector('input[name="course"]');cInput&&(courseId=cInput.value)}var left=(screen.width-900)/2,top=(screen.height-800)/2,topic="",lesson="";if(-1!==window.location.href.indexOf("editsection.php")||-1!==window.location.href.indexOf("section.php")){var topicInput=document.getElementById("id_name")||document.querySelector('input[name="name"]');topicInput&&(topic=topicInput.value)}else{var nameInput=document.querySelector('input[name="name"]')||document.getElementById("id_name");nameInput&&(lesson=nameInput.value);var sectionInput=document.getElementById("id_name_value")||document.getElementById("id_sectionname");if(sectionInput&&sectionInput.value)topic=sectionInput.value;else{var breadcrumbs=document.querySelectorAll(".breadcrumb-item");if(breadcrumbs.length>2)for(var skipList=["settings","general","more","administration","courses","home","edit"],i=breadcrumbs.length-1;i>=0;i--){for(var text=breadcrumbs[i].textContent.trim(),lowerText=text.toLowerCase(),skip=!1,j=0;j<skipList.length;j++)if(-1!==lowerText.indexOf(skipList[j])){skip=!0;break}if(text&&text!==lesson&&!skip){topic=text;break}}if(!topic){var sectionNameEl=document.querySelector(".sectionname")||document.querySelector(".page-header-headings h1")||document.querySelector(".course-section .section-name");if(sectionNameEl){var stext=sectionNameEl.textContent.trim();stext!==lesson&&(topic=stext)}}}}var url=(window.M&&window.M.cfg&&window.M.cfg.wwwroot?window.M.cfg.wwwroot:"")+"/lib/editor/tiny/plugins/aipromptgen/view.php?courseid="+courseId+"&topic="+encodeURIComponent(topic)+"&lesson="+encodeURIComponent(lesson)+"&popup=1";window.open(url,"aipromptgen_popup","width=900,height=800,top="+top+",left="+left+",scrollbars=yes,resizable=yes")};return editor.ui.registry.addButton("tiny_aipromptgen",{icon:"tiny-aipromptgen-icon",tooltip:"AI Prompt Generator",onAction:openPromptGenerator}),editor.ui.registry.addMenuItem("tiny_aipromptgen",{text:"AI Prompt Generator",icon:"tiny-aipromptgen-icon",onAction:openPromptGenerator}),pluginMetadata})),["tiny_aipromptgen/plugin",Configuration]}));return _exports.default=_default,_exports.default}));

//# sourceMappingURL=plugin.min.js.map