{"version":3,"file":"plugin.min.js","sources":["../src/plugin.js"],"sourcesContent":["\nimport {getTinyMCE} from 'editor_tiny/loader';\nimport {getPluginMetadata} from 'editor_tiny/utils';\nimport * as Configuration from './configuration';\n\nexport default Promise.all([\n    getTinyMCE(),\n    getPluginMetadata('tiny_aipromptgen', 'tiny_aipromptgen/plugin'),\n]).then(([tinyMCE, pluginMetadata]) => {\n    tinyMCE.PluginManager.add('tiny_aipromptgen/plugin', (editor) => {\n        // Register the icon with a unique name\n        // eslint-disable-next-line max-len\n        editor.ui.registry.addIcon('tiny-aipromptgen-icon', '<svg width=\"24\" height=\"24\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"none\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"><rect x=\"3\" y=\"11\" width=\"18\" height=\"10\" rx=\"2\"></rect><circle cx=\"12\" cy=\"5\" r=\"2\"></circle><path d=\"M12 7v4\"></path><circle cx=\"8\" cy=\"16\" r=\"1.5\" fill=\"white\" stroke=\"none\"></circle><circle cx=\"16\" cy=\"16\" r=\"1.5\" fill=\"white\" stroke=\"none\"></circle></svg>');\n\n        var openPromptGenerator = function() {\n            var courseId = '1';\n\n            var urlParams = new URLSearchParams(window.location.search);\n            if (urlParams.has('courseid')) {\n                courseId = urlParams.get('courseid');\n            } else if (urlParams.has('id')) {\n                if (window.location.href.indexOf('/course/view.php') !== -1) {\n                    courseId = urlParams.get('id');\n                } else {\n                    var link = document.querySelector('a[href*=\"/course/view.php?id=\"]');\n                    if (link) {\n                        var m = link.href.match(/id=(\\d+)/);\n                        if (m) {\n                            courseId = m[1];\n                        }\n                    }\n                }\n            }\n\n            if (window.M && window.M.cfg && window.M.cfg.courseId && window.M.cfg.courseId != 1) {\n                courseId = window.M.cfg.courseId;\n            }\n\n            if (courseId === '1') {\n                var cInput = document.querySelector('input[name=\"course\"]');\n                if (cInput) {\n                    courseId = cInput.value;\n                }\n            }\n\n            var width = 900;\n            var height = 800;\n            var left = (screen.width - width) / 2;\n            var top = (screen.height - height) / 2;\n\n            // Context Extraction\n            var topic = '';\n            var lesson = '';\n\n            // 1. Activity Name (standard Moodle form field 'name')\n            var nameInput = document.querySelector('input[name=\"name\"]') || document.getElementById('id_name');\n            if (nameInput) {\n                lesson = nameInput.value;\n            }\n\n            // 2. Section/Topic Name (standard Moodle section edit field)\n            // 2. Section/Topic Name\n            var sectionInput = document.getElementById('id_name_value');\n            if (sectionInput) {\n                topic = sectionInput.value;\n            } else {\n                // Fallback: Try to find section name from breadcrumbs or page structure\n                // Common in Moodle: Breadcrumbs can hold the section name\n                var breadcrumbs = document.querySelectorAll('.breadcrumb-item');\n                if (breadcrumbs.length > 1) {\n                    // Usually: Home > Course > Section > Activity\n                    // If editing activity, Section is usually 2nd to last.\n                    // If editing section, it might be the last one (but text might be 'Edit...').\n                    \n                    // Let's try to get the text of the link in the breadcrumb before the last one?\n                    // Or just grab the course shortname if nothing else?\n                    // Better: look for a section header on the page if visible.\n\n                    // Simple logic: If we are in modedit, topic might not be editable.\n                    // Let's try to grab it from the page header if valid? No.\n\n                    // Let's just leave it empty if input not found, BUT check one more ID:\n                    var sectionName = document.querySelector('.sectionname');\n                    if (sectionName) {\n                        topic = sectionName.innerText.trim();\n                    }\n                }\n            }\n            // eslint-disable-next-line max-len\n            var url = (window.M && window.M.cfg && window.M.cfg.wwwroot ? window.M.cfg.wwwroot : '') + '/lib/editor/tiny/plugins/aipromptgen/view.php?courseid=' + courseId + '&topic=' + encodeURIComponent(topic) + '&lesson=' + encodeURIComponent(lesson) + '&popup=1';\n\n            // eslint-disable-next-line max-len\n            window.open(url, 'aipromptgen_popup', 'width=' + width + ',height=' + height + ',top=' + top + ',left=' + left + ',scrollbars=yes,resizable=yes');\n        };\n\n        // Register the button\n        editor.ui.registry.addButton('tiny_aipromptgen', {\n            icon: 'tiny-aipromptgen-icon',\n            tooltip: 'AI Prompt Generator',\n            onAction: openPromptGenerator\n        });\n\n        // Register the menu item\n        editor.ui.registry.addMenuItem('tiny_aipromptgen', {\n            text: 'AI Prompt Generator',\n            icon: 'tiny-aipromptgen-icon',\n            onAction: openPromptGenerator\n        });\n\n        return pluginMetadata;\n    });\n\n    return ['tiny_aipromptgen/plugin', Configuration];\n});\n"],"names":["Promise","all","then","_ref","tinyMCE","pluginMetadata","PluginManager","add","editor","ui","registry","addIcon","openPromptGenerator","courseId","urlParams","URLSearchParams","window","location","search","has","get","href","indexOf","link","document","querySelector","m","match","M","cfg","cInput","value","left","screen","width","top","height","topic","lesson","nameInput","getElementById","sectionInput","querySelectorAll","length","sectionName","innerText","trim","url","wwwroot","encodeURIComponent","open","addButton","icon","tooltip","onAction","addMenuItem","text","Configuration"],"mappings":"mrCAKeA,QAAQC,IAAI,EACvB,yBACA,4BAAkB,mBAAoB,6BACvCC,MAAKC,WAAEC,QAASC,4BACfD,QAAQE,cAAcC,IAAI,2BAA4BC,SAGlDA,OAAOC,GAAGC,SAASC,QAAQ,wBAAyB,icAEhDC,oBAAsB,eAClBC,SAAW,IAEXC,UAAY,IAAIC,gBAAgBC,OAAOC,SAASC,WAChDJ,UAAUK,IAAI,YACdN,SAAWC,UAAUM,IAAI,iBACtB,GAAIN,UAAUK,IAAI,UACqC,IAAtDH,OAAOC,SAASI,KAAKC,QAAQ,oBAC7BT,SAAWC,UAAUM,IAAI,UACtB,KACCG,KAAOC,SAASC,cAAc,sCAC9BF,KAAM,KACFG,EAAIH,KAAKF,KAAKM,MAAM,YACpBD,IACAb,SAAWa,EAAE,QAMzBV,OAAOY,GAAKZ,OAAOY,EAAEC,KAAOb,OAAOY,EAAEC,IAAIhB,UAAqC,GAAzBG,OAAOY,EAAEC,IAAIhB,WAClEA,SAAWG,OAAOY,EAAEC,IAAIhB,UAGX,MAAbA,SAAkB,KACdiB,OAASN,SAASC,cAAc,wBAChCK,SACAjB,SAAWiB,OAAOC,WAMtBC,MAAQC,OAAOC,MAFP,KAEwB,EAChCC,KAAOF,OAAOG,OAFL,KAEwB,EAGjCC,MAAQ,GACRC,OAAS,GAGTC,UAAYf,SAASC,cAAc,uBAAyBD,SAASgB,eAAe,WACpFD,YACAD,OAASC,UAAUR,WAKnBU,aAAejB,SAASgB,eAAe,oBACvCC,aACAJ,MAAQI,aAAaV,cAIHP,SAASkB,iBAAiB,oBAC5BC,OAAS,EAAG,KAapBC,YAAcpB,SAASC,cAAc,gBACrCmB,cACAP,MAAQO,YAAYC,UAAUC,YAKtCC,KAAO/B,OAAOY,GAAKZ,OAAOY,EAAEC,KAAOb,OAAOY,EAAEC,IAAImB,QAAUhC,OAAOY,EAAEC,IAAImB,QAAU,IAAM,0DAA4DnC,SAAW,UAAYoC,mBAAmBZ,OAAS,WAAaY,mBAAmBX,QAAU,WAGpPtB,OAAOkC,KAAKH,IAAK,oBAAqB,4BAAmDZ,IAAM,SAAWH,KAAO,yCAIrHxB,OAAOC,GAAGC,SAASyC,UAAU,mBAAoB,CAC7CC,KAAM,wBACNC,QAAS,sBACTC,SAAU1C,sBAIdJ,OAAOC,GAAGC,SAAS6C,YAAY,mBAAoB,CAC/CC,KAAM,sBACNJ,KAAM,wBACNE,SAAU1C,sBAGPP,kBAGJ,CAAC,0BAA2BoD"}