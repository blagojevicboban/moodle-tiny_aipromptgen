{"version":3,"file":"actions.min.js","sources":["../src/actions.js"],"sourcesContent":["/**\n * This file is part of Moodle - http://moodle.org/\n *\n * Moodle is free software: you can redistribute it and/or modify\n * it under the terms of the GNU General Public License as published by\n * the Free Software Foundation, either version 3 of the License, or\n * (at your option) any later version.\n *\n * Moodle is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n *\n * You should have received a copy of the GNU General Public License\n * along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n */\n\n/**\n * UI actions for the AI Prompt Generator.\n *\n * @package\n * @copyright  2025 AI4Teachers\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['core/str'], function(Str) {\n    const $ = function(sel, root) {\n        root = root || document;\n        return root.querySelector(sel);\n    };\n\n    const attachCopyDownload = function() {\n        const copyBtn = $('#ai4t-copy');\n        const dlBtn = $('#ai4t-download');\n        const sendBtn = $('#ai4t-sendtochat');\n        const ta = $('#ai4t-generated');\n        const form = document.querySelector('form.mform');\n        const copied = $('#ai4t-copied');\n\n        if (copyBtn) {\n            copyBtn.addEventListener('click', function() {\n                if (!ta) {\n                    return;\n                }\n                ta.select();\n                ta.setSelectionRange(0, ta.value.length);\n                const copyPromise = navigator.clipboard && navigator.clipboard.writeText\n                    ? navigator.clipboard.writeText(ta.value)\n                    : Promise.resolve(document.execCommand('copy'));\n                copyPromise.catch(function() {\n                    // Silent fail.\n                });\n                if (copied) {\n                    Str.get_string('form:copied', 'tiny_aipromptgen').then(function(s) {\n                        copied.textContent = s;\n                        copied.style.display = 'inline';\n                        setTimeout(function() {\n                            copied.style.display = 'none';\n                        }, 1500);\n                        return true;\n                    }).catch(function() {\n                        // Silent fail.\n                    });\n                }\n            });\n        }\n\n        if (dlBtn) {\n            dlBtn.addEventListener('click', function() {\n                if (!ta) {\n                    return;\n                }\n                const title = (document.querySelector('title') && document.querySelector('title').textContent) || 'prompt';\n                const slug = title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/^-+|-+$/g, '');\n                const blob = new Blob([ta.value || ''], {type: 'text/plain'});\n                const a = document.createElement('a');\n                a.href = URL.createObjectURL(blob);\n                a.download = slug + '-ai-prompt.txt';\n                document.body.appendChild(a);\n                a.click();\n                setTimeout(function() {\n                    URL.revokeObjectURL(a.href);\n                    a.remove();\n                }, 0);\n            });\n        }\n\n        if (sendBtn) {\n            sendBtn.addEventListener('click', function() {\n                if (!form) {\n                    return;\n                }\n                const i = document.createElement('input');\n                i.type = 'hidden';\n                i.name = 'sendtochat';\n                i.value = '1';\n                form.appendChild(i);\n                form.submit();\n            });\n        }\n    };\n\n    return {\n        attachCopyDownload: attachCopyDownload\n    };\n});\n"],"names":["define","Str","$","sel","root","document","querySelector","attachCopyDownload","copyBtn","dlBtn","sendBtn","ta","form","copied","addEventListener","select","setSelectionRange","value","length","navigator","clipboard","writeText","Promise","resolve","execCommand","catch","get_string","then","s","textContent","style","display","setTimeout","slug","toLowerCase","replace","blob","Blob","type","a","createElement","href","URL","createObjectURL","download","body","appendChild","click","revokeObjectURL","remove","i","name","submit"],"mappings":";;;;;;;AAyBAA,kCAAO,CAAC,aAAa,SAASC,WACpBC,EAAI,SAASC,IAAKC,aACpBA,KAAOA,MAAQC,UACHC,cAAcH,YA0EvB,CACHI,mBAxEuB,iBACjBC,QAAUN,EAAE,cACZO,MAAQP,EAAE,kBACVQ,QAAUR,EAAE,oBACZS,GAAKT,EAAE,mBACPU,KAAOP,SAASC,cAAc,cAC9BO,OAASX,EAAE,gBAEbM,SACAA,QAAQM,iBAAiB,SAAS,eACzBH,UAGLA,GAAGI,SACHJ,GAAGK,kBAAkB,EAAGL,GAAGM,MAAMC,SACbC,UAAUC,WAAaD,UAAUC,UAAUC,UACzDF,UAAUC,UAAUC,UAAUV,GAAGM,OACjCK,QAAQC,QAAQlB,SAASmB,YAAY,UAC/BC,OAAM,eAGdZ,QACAZ,IAAIyB,WAAW,cAAe,oBAAoBC,MAAK,SAASC,UAC5Df,OAAOgB,YAAcD,EACrBf,OAAOiB,MAAMC,QAAU,SACvBC,YAAW,WACPnB,OAAOiB,MAAMC,QAAU,SACxB,OACI,KACRN,OAAM,kBAOjBhB,OACAA,MAAMK,iBAAiB,SAAS,eACvBH,gBAICsB,MADS5B,SAASC,cAAc,UAAYD,SAASC,cAAc,SAASuB,aAAgB,UAC/EK,cAAcC,QAAQ,cAAe,KAAKA,QAAQ,WAAY,IAC3EC,KAAO,IAAIC,KAAK,CAAC1B,GAAGM,OAAS,IAAK,CAACqB,KAAM,eACzCC,EAAIlC,SAASmC,cAAc,KACjCD,EAAEE,KAAOC,IAAIC,gBAAgBP,MAC7BG,EAAEK,SAAWX,KAAO,iBACpB5B,SAASwC,KAAKC,YAAYP,GAC1BA,EAAEQ,QACFf,YAAW,WACPU,IAAIM,gBAAgBT,EAAEE,MACtBF,EAAEU,WACH,MAIPvC,SACAA,QAAQI,iBAAiB,SAAS,eACzBF,kBAGCsC,EAAI7C,SAASmC,cAAc,SACjCU,EAAEZ,KAAO,SACTY,EAAEC,KAAO,aACTD,EAAEjC,MAAQ,IACVL,KAAKkC,YAAYI,GACjBtC,KAAKwC"}