{"version":3,"file":"age.min.js","sources":["../src/age.js"],"sourcesContent":["define([], function() {\n    const $ = function(sel, root) {\n        root = root || document;\n        return root.querySelector(sel);\n    };\n\n    const SimpleModal = function(id) {\n        this.node = document.getElementById(id);\n        this.backdrop = document.getElementById('ai4t-modal-backdrop');\n    };\n    SimpleModal.prototype.open = function(prefill) {\n        if (!this.node) {\n            return;\n        }\n        if (typeof prefill === 'function') {\n            try {\n                prefill();\n            } catch (e) {\n                // Silent fail.\n            }\n        }\n        this.node.style.display = 'block';\n        if (this.backdrop) {\n            this.backdrop.style.display = 'block';\n        }\n        this.node.focus();\n    };\n    SimpleModal.prototype.close = function() {\n        if (!this.node) {\n            return;\n        }\n        this.node.style.display = 'none';\n        if (this.backdrop) {\n            this.backdrop.style.display = 'none';\n        }\n    };\n\n    const initAgeModal = function() {\n        const modal = new SimpleModal('ai4t-age-modal');\n        const openBtn = $('#ai4t-age-browse');\n        const closeBtn = $('#ai4t-age-modal-close');\n        const cancelBtn = $('#ai4t-age-modal-cancel');\n        const insertBtn = $('#ai4t-age-modal-insert');\n        const input = $('#id_agerange');\n        const exact = $('#ai4t-age-exact');\n        const from = $('#ai4t-age-from');\n        const to = $('#ai4t-age-to');\n        const modeExact = $('#ai4t-age-mode-exact');\n        const modeRange = $('#ai4t-age-mode-range');\n\n        const syncEnabled = function() {\n            const useExact = modeExact && modeExact.checked;\n            if (useExact) {\n                if (exact) {\n                    exact.removeAttribute('disabled');\n                }\n                if (from) {\n                    from.setAttribute('disabled', 'disabled');\n                }\n                if (to) {\n                    to.setAttribute('disabled', 'disabled');\n                }\n            } else {\n                if (exact) {\n                    exact.setAttribute('disabled', 'disabled');\n                }\n                if (from) {\n                    from.removeAttribute('disabled');\n                }\n                if (to) {\n                    to.removeAttribute('disabled');\n                }\n            }\n        };\n\n        const prefill = function() {\n            if (!input) {\n                return;\n            }\n            const v = (input.value || '').trim();\n            if (!v) {\n                if (modeExact) {\n                    modeExact.checked = true;\n                }\n                if (exact) {\n                    exact.value = '';\n                }\n                if (from) {\n                    from.value = '';\n                }\n                if (to) {\n                    to.value = '';\n                }\n                syncEnabled();\n                return;\n            }\n            if (/^\\d+$/.test(v)) {\n                if (exact) {\n                    exact.value = v;\n                }\n                if (from) {\n                    from.value = '';\n                }\n                if (to) {\n                    to.value = '';\n                }\n                if (modeExact) {\n                    modeExact.checked = true;\n                }\n                syncEnabled();\n                return;\n            }\n            const m = v.match(/^\\s*(\\d+)\\s*[-\\u2013]\\s*(\\d+)\\s*$/u);\n            if (m) {\n                if (exact) {\n                    exact.value = '';\n                }\n                if (from) {\n                    from.value = m[1];\n                }\n                if (to) {\n                    to.value = m[2];\n                }\n                if (modeRange) {\n                    modeRange.checked = true;\n                }\n                syncEnabled();\n                return;\n            }\n        };\n\n        const onInsert = function() {\n            if (!input) {\n                modal.close();\n                return;\n            }\n            const ev = (exact && exact.value || '').trim();\n            const fv = (from && from.value || '').trim();\n            const tv = (to && to.value || '').trim();\n            const useExact = modeExact && modeExact.checked;\n            if (useExact && ev) {\n                input.value = ev;\n                modal.close();\n                return;\n            }\n            if (!useExact && fv && tv) {\n                let a = parseInt(fv, 10);\n                let b = parseInt(tv, 10);\n                if (!isNaN(a) && !isNaN(b)) {\n                    if (a > b) {\n                        const tmp = a;\n                        a = b;\n                        b = tmp;\n                    }\n                    input.value = a + '-' + b;\n                    modal.close();\n                    return;\n                }\n            }\n            modal.close();\n        };\n\n        if (openBtn) {\n            openBtn.addEventListener('click', function(e) {\n                e.preventDefault();\n                e.stopPropagation();\n                modal.open(prefill);\n            });\n        }\n        if (closeBtn) {\n            closeBtn.addEventListener('click', function() {\n                modal.close();\n            });\n        }\n        if (cancelBtn) {\n            cancelBtn.addEventListener('click', function() {\n                modal.close();\n            });\n        }\n        if (insertBtn) {\n            insertBtn.addEventListener('click', onInsert);\n        }\n        if (modeExact) {\n            modeExact.addEventListener('change', syncEnabled);\n        }\n        if (modeRange) {\n            modeRange.addEventListener('change', syncEnabled);\n        }\n        document.addEventListener('keydown', function(ev) {\n            if (ev.key === 'Escape') {\n                modal.close();\n            }\n        });\n    };\n\n    return {\n        initAgeModal: initAgeModal\n    };\n});\n"],"names":["define","$","sel","root","document","querySelector","SimpleModal","id","node","getElementById","backdrop","prototype","open","prefill","this","e","style","display","focus","close","initAgeModal","modal","openBtn","closeBtn","cancelBtn","insertBtn","input","exact","from","to","modeExact","modeRange","syncEnabled","checked","removeAttribute","setAttribute","v","value","trim","test","m","match","onInsert","ev","fv","tv","useExact","a","parseInt","b","isNaN","tmp","addEventListener","preventDefault","stopPropagation","key"],"mappings":"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"}